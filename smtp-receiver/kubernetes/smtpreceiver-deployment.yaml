apiVersion: v1
kind: ConfigMap
metadata:
  name: smtp-receiver-cfg-cm
data:
  # property-like keys; each key maps to a simple value
  config.yaml: |
    smtp:
      address: 0.0.0.0
      port: 8888
      insecureSkipVerify: true
    direktiv:
      endpoint: https://dev.local/api/namespaces/admin/event
      token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwcmVmZXJyZWRfdXNlcm5hbWUiOiJ0b2tlbi05NDI3YTdjZC1hYTA5LTRjYzQtOTM0Yy1mZmExYTEwN2NkY2IiLCJncm91cHMiOlsidG9rZW4tOTQyN2E3Y2QtYWEwOS00Y2M0LTkzNGMtZmZhMWExMDdjZGNiIl0sImV4cCI6MTYyNzUyMDgzOCwiaXNzIjoiZGlyZWt0aXYifQ.-G6ZDA09y86Fzc8U2D11Z1tcFwh7eWnL-KbgiNd8HI8
    internal: vorteil.io
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: smtp-listener
  labels:
    app: smtp-listener
spec:
  replicas: 1
  selector:
    matchLabels:
      app: smtp-listener
  template:
    metadata:
      labels:
        app: smtp-listener
    spec:
      volumes:
      - name: smtpconf
        configMap:
          name: smtp-receiver-cfg-cm
          # items:
          # - key: "config.yaml"
          #   path: "config.yaml"
      securityContext:
        runAsNonRoot: true
        runAsUser: 33333
        runAsGroup: 22222
      containers:
        - name: smtp-listener
          image: trentis/smtp-receiver:v3
          ports:
            - containerPort: 8888
          volumeMounts:
          - name: smtpconf
            mountPath: "/config"
            readOnly: false
--- 
apiVersion: v1 
kind: Service
metadata:
  name: smtp-listener-service
spec:
  type: NodePort
  selector:
    app: smtp-listener
  ports:
    - port: 8888
      nodePort: 30123
